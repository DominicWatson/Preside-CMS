!function(a){a.alert=function(b){var c={type:"success",message:"",sticky:!1};b=a.extend(c,b),b.type=b.type.toLowerCase(),"undefined"==typeof b.title&&(b.title=i18n.translateResource("cms:frontendadmin."+b.type+".alert.title")),a.gritter.add({title:b.title,text:b.message,class_name:"gritter-"+b.type+" preside-frontend-msgbox",sticky:b.sticky})}}(presideJQuery),function(a){var b,c,d,e,f=a("#preside-admin-toolbar"),g=a("body"),h=a("script.content-editor"),i=a("*").contents().filter(function(){return 8===this.nodeType}),j=[],k=!1;if(b=function(){h.each(function(){var b,c=a(this).data("presideeditor"),d=c.find(".content-editor-overlay .inner"),e=c.data("parent"),f=c.attr("id"),g="container: "+f,h="!"+g,k={},l=a("<div></div>"),m=a("<div></div>");"undefined"!=typeof e&&(i.each(function(){a.trim(this.nodeValue)===g?a(this).before(l):a.trim(this.nodeValue)===h&&(b=a(this),b.after(m))}),k.width=l.width(),k.top=l.offset().top+l.height(),k.left=l.offset().left,k.height=m.offset().top-k.top,k.height<25&&(j.push(a("<div></div>").height(25-k.height)),b.before(j[j.length-1]),k.height=25),l.remove(),m.remove(),c.css({top:k.top+"px",left:k.left+"px"}),c.width(k.width),c.height(k.height),d.width(c.outerWidth(!0)),d.height(c.outerHeight(!0)))})},c=function(){for(;j.length;){try{j[0].remove()}catch(a){}j.shift()}},d=function(d){k=d,d?(g.addClass("show-frontend-editors"),b()):(g.removeClass("show-frontend-editors"),c()),a.cookie("_presideEditMode",d?"true":"false")},e=function(){var b=a("#edit-mode-options"),c=b.prop("checked"),d=!c;b.prop("checked",d),b.trigger("change")},f.on("click change","#edit-mode-options",function(b){var c=a(this);d(c.prop("checked"))}),g.keydown("e",function(a){userIsTyping()||(a.preventDefault(),e())}),a(window).resize(function(){b()}),setInterval(function(){k&&b()},1e3),a.fn.presideFrontEndEditor=function(c){return this.each(function(){var c,d,e,f,h,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=a(this),A=a(z.html()),B=A.find(".content-editor-editor-container"),C=(A.find(".content-editor-overlay .inner"),B.find("form")),D=C.find("[name=content]"),E=B.find("textarea[name=draftContent]"),F=z.parent(),G=A.find(".content-editor-editor-notifications"),H=B.find(".version-history-link"),I=A.hasClass("richeditor"),J=C.attr("action"),K=C.data("saveDraftAction"),L=C.data("discardDraftAction"),M=D.val(),N=E.length&&E.val().length?E.val():M,O=!1,P=1500,Q=null,R='<i class="preside-icon fa fa-trash-o discard-draft" title="'+i18n.translateResource("cms:frontendeditor.discard.draft.link")+'"></i> ',S='<i class="preside-icon fa fa-history"></i> ';z.appendTo("body"),A.appendTo("body"),A.data("parent",F),B.appendTo("body"),z.data("presideeditor",A),d=function(a){O=a,a?(window.addEventListener("beforeunload",r,!1),B.addClass("edit-active"),g.addClass("frontend-editors-editing"),I?t():v()):(window.removeEventListener("beforeunload",r,!1),I&&u(),B.removeClass("edit-active"),g.removeClass("frontend-editors-editing")),b()},t=function(){A.data("_rawContent",D.val()),E.val().length&&(i(R+i18n.translateResource("cms:frontendeditor.draft.loaded.notification")),D.val(E.val())),c=new PresideRichEditor(D.get(0)).editor,c.on("change",function(a){e()}),c.on("instanceReady",function(b){M===N?M=b.editor.getData():N=b.editor.getData(),e(),b.editor.focus(),a("html, body").scrollTop(A.offset().top-20)}),c.on("key",function(a){var b=a.data.keyCode,e=27,f=13+CKEDITOR.CTRL,g=13+CKEDITOR.ALT;if(O){if(b===e)return d(!1),!1;if(b===f&&q())return h(),!1;if(b===g)return c.execCommand("maximize"),!1;null!==Q&&window.clearTimeout(Q),Q=window.setTimeout(m,P)}})},u=function(){m(),D.val(A.data("_rawContent")),s(),c.destroy()},v=function(){D.on("change keyup click focus blur",function(a){e()}),D.focus()},s=function(){"undefined"!=typeof c.commands.maximize&&1===c.commands.maximize.state&&c.execCommand("maximize")},p=function(){return c.getData()!=N&&c.getData()!=M},q=function(){return!0},e=function(){O&&B.find(".editor-btn-save").prop("disabled",!q())},i=function(a){G.html(a)},j=function(){i("")},l=function(a){"undefined"==typeof a&&(a=!0),O=!a,C.prop("disabled",a),C.find(":input").prop("disabled",a),a||e()},h=function(){I&&s(),confirm(i18n.translateResource("cms:frontendeditor.confirm.save.prompt"))?f():c.focus()},w=function(b){for(var c,d,e=F.contents(),f=A.attr("id"),g="container: "+f,h="!"+g,i=0,j=e.length,k=!1;j>i;i++)if(c=e[i],k||8!==c.nodeType||a.trim(c.nodeValue)!==g){if(k){if(8===c.nodeType&&a.trim(c.nodeValue)===h)break;a(c).remove()}}else k=!0,d=a(c);"undefined"!=typeof d&&d.after(b)},f=function(b){var e,f;b=a.extend({draft:!1,url:J},b),I&&(D.val(c.getData()),b.draft||A.data("_rawContent",D.val())),f=D.val(),e=C.serializeArray(),i(b.draft?i18n.translateResource("cms:frontendeditor.saving.draft.notification"):i18n.translateResource("cms:frontendeditor.saving.notification")),l(),a.post(b.url,e,function(c){c.success&&(b.draft||"undefined"!=typeof c.rendered)?(N=f,b.draft?(E.val(f),A.addClass("has-draft"),i(R+i18n.translateResource("cms:frontendeditor.saved.draft.notification",{data:[a.dateformat.date(new Date,"HH:mm:ss")]}))):(M=f,w(c.rendered),d(!1),I&&o(),c.message&&a.alert({message:c.message}))):c.error?a.alert({type:"error",message:c.error,sticky:!0}):a.alert({type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).fail(function(b){var c=b.responseJSON||{};c.error?a.alert({type:"error",message:c.error,sticky:!0}):a.alert({type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).always(function(a){b.draft&&a.success||j(),l(!1)})},n=function(){i(R+i18n.translateResource("cms:frontendeditor.discarding.draft.notification")),a.post(L,C.serializeArray(),function(b){b.success?(o(),b.message&&a.alert({message:b.message})):b.error?a.alert({type:"error",message:b.error,sticky:!0}):a.alert({type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).fail(function(b){var c=b.responseJSON||{};c.error?a.alert({type:"error",message:c.error,sticky:!0}):a.alert({type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).always(function(){j()})},o=function(){E.val(""),D.val(A.data("_rawContent")),A.removeClass("has-draft"),M=N=D.val(),c.setData(M),e()},m=function(){p()&&f({draft:!0,url:K})},r=function(){return m(),q()?i18n.translateResource("cms:frontendeditor.browser.exit.warning"):void 0},x=function(b){var c=a(b).find(".field-version-table"),d=a(b).find(".preview-pane"),e=i18n.translateResource("cms:frontendeditor.version.entityname"),f=[{mData:"datemodified",sWidth:"18em"},{mData:"_version_author"},{sClass:"center",bSortable:!1,mData:"_options",sWidth:"9em"}];"undefined"==typeof c.data("setupVersionTableUi")&&(c.on("click",".preview-version",function(b){b.preventDefault();var c=a(this),e=c.closest("tr"),f=d.html();e.addClass("selected").siblings().removeClass("selected"),d.html(""),d.addClass("loading"),a.ajax({method:"GET",url:c.attr("href"),success:function(a){setTimeout(function(){d.removeClass("loading"),d.html(a)},400)},error:function(){d.html(f),d.removeClass("loading"),a.alert({type:"error",message:i18n.translateResource("cms:frontendeditor.previewversion.unknown.error"),sticky:!0})}})}),c.on("click",".load-version",function(c){c.preventDefault();var d=a(this);a.ajax({method:"GET",url:d.attr("href"),cache:!1,success:function(c){"object"==typeof c&&c.success&&"undefined"!=typeof c.content?(y(c.content),b.on("hidden.bs.modal",function(){b.remove()}),b.modal("hide")):a.alert({type:"error",message:i18n.translateResource("cms:frontendeditor.loadversion.unknown.error"),sticky:!0})},error:function(){a.alert({type:"error",message:i18n.translateResource("cms:frontendeditor.loadversion.unknown.error"),sticky:!0})}})}),c.dataTable({bServerSide:!0,bProcessing:!1,bFilter:!1,bLengthChange:!1,iDisplayLength:4,aoColumns:f,sDom:"t<'row'<'col-sm-6'i><'col-sm-6'p>>",sAjaxSource:c.data("remote"),fnRowCallback:function(b){$row=a(b),$row.attr("data-context-container","1"),$row.addClass("clickable")},oLanguage:{oAria:{sSortAscending:i18n.translateResource("cms:datatables.sortAscending",{}),sSortDescending:i18n.translateResource("cms:datatables.sortDescending",{})},oPaginate:{sFirst:i18n.translateResource("cms:datatables.first",{data:[e],defaultValue:""}),sLast:i18n.translateResource("cms:datatables.last",{data:[e],defaultValue:""}),sNext:i18n.translateResource("cms:datatables.next",{data:[e],defaultValue:""}),sPrevious:i18n.translateResource("cms:datatables.previous",{data:[e],defaultValue:""})},sEmptyTable:i18n.translateResource("cms:datatables.emptyTable",{data:[e],defaultValue:""}),sInfo:i18n.translateResource("cms:datatables.info",{data:[e],defaultValue:""}),sInfoEmpty:i18n.translateResource("cms:datatables.infoEmpty",{data:[e],defaultValue:""}),sInfoFiltered:i18n.translateResource("cms:datatables.infoFiltered",{data:[e],defaultValue:""}),sInfoThousands:i18n.translateResource("cms:datatables.infoThousands",{data:[e],defaultValue:""}),sLengthMenu:i18n.translateResource("cms:datatables.lengthMenu",{data:[e],defaultValue:""}),sLoadingRecords:i18n.translateResource("cms:datatables.loadingRecords",{data:[e],defaultValue:""}),sProcessing:i18n.translateResource("cms:datatables.processing",{data:[e],defaultValue:""}),sZeroRecords:i18n.translateResource("cms:datatables.zeroRecords",{data:[e],defaultValue:""}),sSearch:"",sUrl:"",sInfoPostFix:""}}),c.data("setupVersionTableUi",!0))},y=function(a){A.data("_rawContent",a),I?o():(M=a,D.val(a)),i(S+i18n.translateResource("cms:frontendeditor.version.loaded.notification"))},A.on("click",".content-editor-overlay,.content-editor-label",function(a){a.preventDefault(),d(!0)}),A.keydown("return",function(a){k&&(a.preventDefault(),d(!0))}),B.on("click",".editor-btn-cancel",function(a){a.preventDefault(),d(!1)}),B.on("click",".editor-btn-save",function(a){a.preventDefault(),h()}),B.on("click",".discard-draft",function(a){a.preventDefault(),n()}),B.on("submit",".content-editor-form",function(a){a.preventDefault()}),H.presideBootboxModal({onShow:x})})},h.presideFrontEndEditor(),h.length){var l=function(){var b=0;return a("[tabindex]").each(function(){var c=parseInt(a(this).attr("tabindex"));!isNaN(c)&&c>b&&(b=c)}),b+1}();g.attr("data-nav-list","1"),g.data("navListChildSelector",".content-editor"),h.each(function(b){a(this).data("presideeditor").attr("tabindex",l+b)}),g.append('<div class="frontend-editor-modal-sheen"></div>')}if("undefined"!=typeof a.cookie("_presideEditMode")){var m=a.cookie("_presideEditMode"),n=a("#edit-mode-options"),o="true"==m;n.prop("checked",o),d(o)}}(presideJQuery);
//# sourceMappingURL=_frontend.min.map
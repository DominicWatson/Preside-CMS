!function(a){var b=cfrequest.rulesEngineExpressions||{},c=cfrequest.rulesEngineRenderFieldEndpoint||"",d=function(){function b(a,b,c){this.$formControl=a,this.$ruleList=c,this.model=this.deserialize(this.$formControl.val()),this.expressions=b,this.fieldRenderCache={},this.render()}return b.prototype.persistToHiddenField=function(){this.$formControl.val(this.serialize())},b.prototype.serialize=function(){return JSON.stringify(this.model)},b.prototype.deserialize=function(a){if(this.isValidSerializedCondition(a))try{return JSON.parse(a)}catch(a){}return[]},b.prototype.isValidSerializedCondition=function(b){return"string"==typeof b&&0!==a.trim(b).length},b.prototype.render=function(){var b,c,d,e=this;for(c=function(b,d){var f,g,h=[],i=20*d,j='<li style="margin-left:'+i+'px"></li>';for(g=0;g<b.length;g++){var k=g%2,l=b[g];k?(f=a(j),f.html(l),h.push(f)):Array.isArray(l)?h=h.concat(c(l,d+1)):(f=a(j),f.html(e.renderExpression(l)),h.push(f))}return h},b=c(this.model,0),this.$ruleList.html(""),d=0;d<b.length;d++)this.$ruleList.append(b[d])},b.prototype.addExpression=function(a){var b=this.newExpression(a);this.model.length&&this.model.push("and"),this.model.push(b),this.persistToHiddenField(),this.render()},b.prototype.newExpression=function(a){var b,c=this.getExpression(a);if(null===c)return{};b={expression:c.id,fields:{}};for(fieldName in c.fields)"undefined"==typeof c.fields[fieldName].default?b.fields[fieldName]=null:b.fields[fieldName]=c.fields[fieldName].default;return b},b.prototype.getExpression=function(a){var b,c;for(b=this.expressions.length-1;b>=0;b--)if(c=this.expressions[b],c.id.toLowerCase()===a.toLowerCase())return c},b.prototype.removeExpression=function(){console.log("TODO: removeExpression() logic"),this.persistToHiddenField(),this.render()},b.prototype.saveExpressionFieldValue=function(){console.log("TODO: saveExpressionFieldValue() logic"),this.persistToHiddenField(),this.render()},b.prototype.renderExpression=function(b){var c,d,e,f,g,h=this.getExpression(b.expression),i=h.text||"",j=a("<span></span>");if("undefined"==typeof h.id)return"";for(c in b.fields)e=new RegExp("{"+c+"}","gi"),i=i.replace(e,'<span data-field-name="'+c+'"></span>');j.html(i);for(c in b.fields)d=b.fields[c],g=j.find("[data-field-name="+c+"]"),f=h.fields[c]||{},this.renderField(c,d,f,g);return j},b.prototype.renderField=function(b,d,e,f){var g=JSON.stringify({fieldName:b,fieldValue:d,fieldDefinition:e});null!==d?(f.addClass("rules-engine-condition-builder-field-loading").html("&hellip;"),this.fieldRenderCache[g]||(this.fieldRenderCache[g]=a.post(c,a.extend({},{fieldValue:d},e))),this.fieldRenderCache[g].done(function(a){f.html('<a class="rules-engine-condition-builder-field-link">'+a+"</a>")})):f.html('<a class="rules-engine-condition-builder-field-link">['+e.defaultLabel+"]</a>")},b}();a.fn.rulesEngineConditionBuilder=function(){return this.each(function(){var c,e,f,g,h,i,j,k,l=a(this),m=l.next("div.rules-engine-condition-builder"),n=m.find(".rules-engine-condition-builder-expression-search"),o=m.find(".rules-engine-condition-builder-expressions-list"),p=m.find(".rules-engine-condition-builder-condition-pane"),q=m.find(".rules-engine-condition-builder-rule-list"),r=o.find("> li"),s=(l.attr("tabindex"),l.val(),b[l.attr("id")]||[]);g=function(){var b=l.attr("id"),g=l.attr("name"),j=(l.attr("tabindex"),l.val());m.removeClass("hide"),n.on("keyup",f),c=a('<input type="hidden">'),c.val(j),c.attr("name",g),l.after(c),l.remove(),c.attr("id",b),e=new d(c,s,q),h(),i()},h=function(){r.each(function(){var b=a(this);b.data("originalText",b.text())})},f=function(){var b=n.val();r.each(function(){var c=a(this),d=c.data("originalText");b.length?d.toLowerCase().includes(b.toLowerCase())?(c.removeClass("hide"),c.html(d.replace(new RegExp(b,"gi"),function(a){return"<b>"+a+"</b>"}))):c.addClass("hide"):(c.removeClass("hide"),c.html(d))})},i=function(){r.draggable({helper:"clone"}),p.droppable({accept:r,drop:j,hoverClass:"ui-droppable-hover"})},j=function(a,b){var c=b.draggable.clone();e.addExpression(c.data("id"))},k=function(){},g()})},a("textarea.rules-engine-condition-builder").rulesEngineConditionBuilder()}(presideJQuery);
//# sourceMappingURL=_rulesEngineConditionBuilder.min.map
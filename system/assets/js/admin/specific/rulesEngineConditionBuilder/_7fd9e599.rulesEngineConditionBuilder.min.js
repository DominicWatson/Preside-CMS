!function(a){var b=cfrequest.rulesEngineExpressions||{},c=function(){function b(a,b,c){this.$formControl=a,this.$ruleList=c,this.model=this.deserialize(this.$formControl.val()),this.expressions=b,this.render()}return b.prototype.persistToHiddenField=function(){this.$formControl.val(this.serialize())},b.prototype.serialize=function(){return JSON.stringify(this.model)},b.prototype.deserialize=function(a){if(this.isValidSerializedCondition(a))try{return JSON.parse(a)}catch(a){}return[]},b.prototype.isValidSerializedCondition=function(b){return"string"==typeof b&&0!==a.trim(b).length},b.prototype.render=function(){var a,b,c,d=this;for(b=function(a,c){var e,f=[],g=10*c,h='<li style="margin-left:'+g+'px">';for(e=0;e<a.length;e++){var i=e%2,j=a[e];i?f.push(h+j+"</li>"):Array.isArray(j)?f.concat(b(j,c+1)):f.push(h+d.getExpression(j.expression).text+"</li>")}return f},a=b(this.model,0),this.$ruleList.html(""),c=0;c<a.length;c++)this.$ruleList.append(a[c])},b.prototype.addExpression=function(a){var b=this.newExpression(a);this.model.length&&this.model.push("and"),this.model.push(b),this.persistToHiddenField(),this.render()},b.prototype.newExpression=function(a){var b,c=this.getExpression(a);if(null===c)return{};b={expression:c.id,fields:{}};for(fieldName in c.fields)"undefined"==typeof c.fields[fieldName].default?b.fields[fieldName]=null:b.fields[fieldName]=c.fields[fieldName].default;return b},b.prototype.getExpression=function(a){var b,c;for(b=this.expressions.length-1;b>=0;b--)if(c=this.expressions[b],c.id.toLowerCase()===a.toLowerCase())return c},b.prototype.removeExpression=function(){console.log("TODO: removeExpression() logic"),this.persistToHiddenField(),this.render()},b.prototype.saveExpressionFieldValue=function(){console.log("TODO: saveExpressionFieldValue() logic"),this.persistToHiddenField(),this.render()},b}();a.fn.rulesEngineConditionBuilder=function(){return this.each(function(){var d,e,f,g,h,i,j,k,l=a(this),m=l.next("div.rules-engine-condition-builder"),n=m.find(".rules-engine-condition-builder-expression-search"),o=m.find(".rules-engine-condition-builder-expressions-list"),p=m.find(".rules-engine-condition-builder-condition-pane"),q=m.find(".rules-engine-condition-builder-rule-list"),r=o.find("> li"),s=(l.attr("tabindex"),l.val(),b[l.attr("id")]||[]);g=function(){var b=l.attr("id"),g=l.attr("name"),j=(l.attr("tabindex"),l.val());m.removeClass("hide"),n.on("keyup",f),d=a('<input type="hidden">'),d.val(j),d.attr("name",g),l.after(d),l.remove(),d.attr("id",b),e=new c(d,s,q),h(),i()},h=function(){r.each(function(){var b=a(this);b.data("originalText",b.text())})},f=function(){var b=n.val();r.each(function(){var c=a(this),d=c.data("originalText");b.length?d.toLowerCase().includes(b.toLowerCase())?(c.removeClass("hide"),c.html(d.replace(new RegExp(b,"gi"),function(a){return"<b>"+a+"</b>"}))):c.addClass("hide"):(c.removeClass("hide"),c.html(d))})},i=function(){r.draggable({helper:"clone"}),p.droppable({accept:r,drop:j,hoverClass:"ui-droppable-hover"})},j=function(a,b){var c=b.draggable.clone();e.addExpression(c.data("id"))},k=function(){},g()})},a("textarea.rules-engine-condition-builder").rulesEngineConditionBuilder()}(presideJQuery);
//# sourceMappingURL=_rulesEngineConditionBuilder.min.map